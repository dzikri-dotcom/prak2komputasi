pipeline {
  agent any

  environment {
    // Nama image yang akan dibuild dan dikirim ke Docker Hub
    IMAGE_NAME = 'yourdockerusername/simple-app'
    // ID credential Docker Hub yang kamu buat di Jenkins
    REGISTRY_CREDENTIALS = 'dockerhub-credentials'
  }

  stages {
    stage('Checkout') {
      steps {
        echo 'Mengambil source code dari GitHub...'
        checkout scm
      }
    }

    stage('Build') {
      steps {
        bat 'echo "Build di Windows dimulai..."'
      }
    }

    stage('Build Docker Image') {
      steps {
        echo 'Membangun Docker image dari folder simple-app...'
        // Karena Dockerfile ada di dalam folder simple-app
        bat 'docker build -f simple-app/Dockerfile -t %IMAGE_NAME%:%BUILD_NUMBER% simple-app'
      }
    }

    stage('Push Docker Image') {
      steps {
        echo 'Login ke Docker Hub dan push image...'
        withCredentials([usernamePassword(
          credentialsId: REGISTRY_CREDENTIALS,
          usernameVariable: 'USER',
          passwordVariable: 'PASS'
        )]) {
          bat 'docker login -u %USER% -p %PASS%'
          bat 'docker push %IMAGE_NAME%:%BUILD_NUMBER%'
          bat 'docker tag %IMAGE_NAME%:%BUILD_NUMBER% %IMAGE_NAME%:latest'
          bat 'docker push %IMAGE_NAME%:latest'
        }
      }
    }
  }

  post {
    always {
      bat 'echo "Pipeline selesai dijalankan."'
    }
  }
}
